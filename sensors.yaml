- platform: yr
  name: Weather
  forecast: 1
  monitored_conditions:
    - temperature
    - symbol
    - precipitation
    - windSpeed
    - pressure
    - windDirection
    - humidity
    - fog
    - cloudiness
    - lowClouds
    - mediumClouds
    - highClouds
    - dewpointTemperature
- platform: moon
- platform: systemmonitor
  resources:
    - type: disk_use_percent
      arg: /home
    - type: memory_free
    - type: processor_use
    - type: since_last_boot
- platform: command_line
  name: SSL cert expiry
  unit_of_measurement: days
  scan_interval: 10800
  command: "ssl-cert-check -b -c /etc/letsencrypt/live/has.nizmo.eu/cert.pem | awk '{ print $NF }'"
- platform: travisci
  api_key: !secret travisapi
  scan_interval: 3600
  repository: Home-AssistantConfig
  branch: master
  monitored_conditions: 
    - last_build_state
    - last_build_id
    - last_build_duration
    - state
- platform: template
  sensors:
    battery_status:
      friendly_name: "Battery Status"
      entity_id:
      - input_boolean.battery_status_update
      value_template: >
        {%- set threshold = 20 -%}
        {%- set domains = ['light', 'switch', 'sensor', 'zwave', 'lock'] -%}
        {%- for domain in domains -%}
        {%- for item in states[domain] if ((item.attributes.battery_level is defined and item.attributes['battery_level'] | int < threshold) or ("battery" in item.name | lower and ((item.state | int < threshold and item.state|int != 0) or item.state | lower == "low" or item.state | lower == "unknown"))) -%}
        {%- if (item.attributes.battery_level is defined and item.attributes['battery_level'] | int < threshold) -%}
        {{ item.name }} ({{ item.attributes['battery_level'] }}){%- if not loop.last %}, {% endif -%}{% endif -%}
        {%- if "battery" in item.name | lower and ((item.state | int < threshold and item.state|int != 0) or item.state | lower == "low" or item.state | lower == "unknown") -%}
        {{ item.name }} ({{ item.state }}){%- if not loop.last %}, {% endif -%} {% endif -%}
        {%- endfor -%}
        {%- endfor -%}
#  - platform: airvisual
#    api_key: !secret airvisual_api_key
#    monitored_conditions:
#      - us
#      - cn
#    latitude: !secret home_latitude
#    longitude: !secret home_longitude
#    radius: 500
#    show_on_map: true

- platform: mqtt
  state_topic: "owntracks/Nizm0/phone"
  name: "Nizm0 battery"
  unit_of_measurement: "%"
  value_template: '{{ value_json.batt }}'
- platform: mqtt
  state_topic: "owntracks/gosia/phone"
  name: "Gosia battery"
  unit_of_measurement: "%"
  value_template: '{{ value_json.batt }}'
- platform: mqtt
  state_topic: "owntracks/tablet1/tablet"
  name: "Tablet battery"
  unit_of_measurement: "%"
  value_template: '{{ value_json.batt }}'
# - platform: attributes
#   friendly_name: "Bedroom room batteries"
#   attribute: battery_level
#   unit_of_measurement: "%"
#   entities:
#     - sensor.bedroom_temperature
- platform: template
  sensors:
    bedroom_battery_level:
      friendly_name: "Bedroom room batteries"
      # entity_id: sensor.bedroom_temperature
      unit_of_measurement: "%"
      value_template: "{{states.sensor.bedroom_temperature.attributes.battery_level}}"
      icon_template: '{% if states.binary_sensor.bedroom_temperature.attributes.battery_level == 100 %}
                          mdi:battery
                      {% elif states.binary_sensor.bedroom_temperature.attributes.battery_level >= 90 %}
                          mdi:battery-90
                      {% elif states.binary_sensor.bedroom_temperature.attributes.battery_level >= 80 %}
                          mdi:battery-80
                      {% elif states.binary_sensor.bedroom_temperature.attributes.battery_level >= 70 %}
                          mdi:battery-70
                      {% elif states.binary_sensor.bedroom_temperature.attributes.battery_level >= 60 %}
                          mdi:battery-60
                      {% elif states.binary_sensor.bedroom_temperature.attributes.battery_level >= 50 %}
                          mdi:battery-50
                      {% elif states.binary_sensor.bedroom_temperature.attributes.battery_level >= 40 %}
                          mdi:battery-40
                      {% elif states.binary_sensor.bedroom_temperature.attributes.battery_level >= 30 %}
                          mdi:battery-30
                      {% elif states.binary_sensor.bedroom_temperature.attributes.battery_level >= 20 %}
                          mdi:battery-20
                      {% elif states.binary_sensor.bedroom_temperature.attributes.battery_level >= 10 %}
                          mdi:battery-10
                      {% else %}
                          mdi:battery-charging-wireless-outline
                      {% endif %}'
